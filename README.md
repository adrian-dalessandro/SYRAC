# SYRAC: Synthesize, Rank, & Count

![Publication](https://img.shields.io/badge/Publication-ArXiv-red.svg)
![License](https://img.shields.io/badge/License-CreativeML_Open_RAIL_M-blue.svg)
![Python](https://img.shields.io/badge/Python-3.8-blue.svg)
[![TensorFlow](https://img.shields.io/badge/TensorFlow-2.8-orange.svg)](https://github.com/tensorflow/tensorflow/releases/tag/v2.8.0)
[![TensorFlow Addons](https://img.shields.io/badge/TensorFlow_Addons-0.16.1-orange.svg)](https://www.tensorflow.org/addons/overview)


Repository for the SYRAC project, which explores unsupervised object counting using a weak ranking generated by latent diffusion models.

![Synthetic Images Header](figures/synthetic_images.png)

## Overview
Crowd counting is a fundamental task in computer vision with various practical applications. However, existing methods rely on labor-intensive density map annotations, involving manual pedestrian localization. Recent attempts at weakly or semi-supervised learning have not adequately reduced this annotation workload.

**Our Approach**: We propose a novel solution that leverages latent diffusion models to generate synthetic data, eliminating the need for manual annotation. However, latent diffusion models struggle to accurately estimate object quantities, leading to noisy annotations when producing images with specific object counts.

**Our Solution**: To address this challenge, we use latent diffusion models to create two types of synthetic data:

1. **Ranked Image Pairs**: We remove pedestrians from real images, generating ranked image pairs with a weak but reliable signal for object quantity.
2. **Synthetic Images with Fixed Object Counts**: We generate synthetic images with predetermined object counts, offering a strong but noisy counting signal.

Our approach employs the ranked image pairs for pre-training and fits a linear layer to the noisy synthetic images using crowd quantity features. Our method achieves state-of-the-art performance in unsupervised crowd counting, demonstrating its effectiveness in reducing annotation requirements for computer vision tasks.

### Data

We will be updating this repository with a link to the synthetic and real data shortly.

## Requirements
```python
tensorflow==2.8
tensorflow_addons==0.16.1
protobuf==4.21.5
scikit_image==0.18.1
tifffile==2023.4.12
```
## Installation

```bash
# Example installation steps
$ git clone https://github.com/adrian-dalessandro/SYRAC.git
$ cd SYRAC
$ pip install -r requirements.txt
```

## Usage
Running the model

```bash
# Training from scratch
$ python train_wrapper.py --experiment training/baseline \ 
                          --params_dir "./config/" \
                          --dataset "YOUR_DATASET" \
                          --data_dir "path/to/dataset" \
                          --experiment_dir "path/to/experiments" \
                          --experiment_name "name_your_experiment"
```
Fine-tuning the model
```bash
# Finetuning pre-trained model
$ python3 finetune_wrapper.py --experiment finetuning/unsupervised/noisy_synth_regress \
                         --data_dir "path/to/dataset" \
                         --train_data "DS_NOISY_SYNTH" \
                         --test_data "YOUR_DATASET" \
                         --N 2 \
                         --experiment_path "path/to/experiments" \
                         --model_path "path_to_saved_model" \
                         --params_dir "./config/"
```

## License

We release all source code under the Open RAIL-S LICENSE